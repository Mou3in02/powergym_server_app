{# templates/pers_entry/chart.html.twig #}
{% extends 'base_dashboard.html.twig' %}

{% block title %}Statistiques des entrées{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/bootstrap-datepicker.min.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <style>
        .select2-container .select2-selection {
            font-size: 15px;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="content-wrapper">
        <!-- Header -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h4 class="h4">Statistiques des entrées</h4>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <!-- Bar chart  -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-info">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div class="col-4 d-flex justify-content-start">
                                    <h3 class="card-title">Entrées mensuelles ({{ currentYear }})</h3>
                                </div>
                                <div class="col-8 d-flex justify-content-start">
                                    <div class="d-flex flex-row align-items-center">
                                        <label for="person_list" class="mr-2 mb-0 text-white">Client</label>
                                        <select name="person_list" id="person_list"
                                                class="form-control form-control-sm mr-2" required>
                                            <option value=""></option>
                                            {% for pin, client in clients %}
                                                <option value="{{ pin }}">
                                                    {{ client }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                        <button id="yearly_bar_chart_search" class="btn btn-light btn-sm mx-2">
                                            Rechercher
                                        </button>
                                        <div id="yearly_bar_chart_spinner"
                                             class="spinner-border spinner-border-sm invisible"
                                             role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="yearly_bar_chart"
                                        style="min-height: 250px; height: 250px; max-height: 400px; max-width: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-danger">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div class="col-4 d-flex justify-content-start">
                                    <h3 class="card-title mb-0">Entrée hebdomadaire</h3>
                                </div>
                                <div class="col-4 d-flex justify-content-center">
                                    <div class="d-flex flex-row align-items-center">
                                        <label for="weekDate" class="mr-2 mb-0 text-white">Jour</label>
                                        <input type="text" id="weekDate" class="form-control form-control-sm" value="">
                                        <button id="weakly_bar_chart_search" class="btn btn-light btn-sm mx-2">
                                            Rechercher
                                        </button>
                                        <div id="weakly_bar_chart_spinner"
                                             class="spinner-border spinner-border-sm invisible"
                                             role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 d-flex justify-content-end">
                                    <span id="selected_week"></span>
                                </div>

                            </div>
                            <div class="card-body">
                                <canvas id="weakly_bar_chart"
                                        style="min-height: 250px; height: 250px; max-height: 400px; max-width: 100%; width: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-info">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div class="col-4 d-flex justify-content-start">
                                    <h3 class="card-title mb-0">Nombre total de clients par mois</h3>
                                </div>
                                <div class="col-4 d-flex justify-content-center">
                                    <div class="d-flex flex-row align-items-center">
                                        <label for="year_list" class="mr-2 mb-0 text-white">Année</label>
                                        <select name="year_list" id="year_list"
                                                class="form-control form-control-sm mr-2" required>
                                            <option value="">-- Sélectionner --</option>
                                            <option value="2026">2026</option>
                                            <option value="2025">2025</option>
                                            <option value="2024">2024</option>
                                            <option value="2023">2023</option>
                                            <option value="2025">2022</option>
                                            <option value="2025">2021</option>
                                            <option value="2025">2020</option>
                                        </select>
                                        <button id="monthly_bar_chart_search" class="btn btn-light btn-sm mx-2">
                                            Rechercher
                                        </button>
                                        <div id="monthly_bar_chart_spinner"
                                             class="spinner-border spinner-border-sm invisible"
                                             role="status">
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 d-flex justify-content-end">
                                    <span></span>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="monthly_bar_chart"
                                        style="min-height: 250px; height: 250px; max-height: 400px; max-width: 100%; width: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </section>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>
    <script src="{{ asset('js/pages/bootstrap-datepicker.min.js') }}"></script>
    <script src="{{ asset('locales/bootstrap-datepicker.fr.min.js') }}"></script>
    <script src="{{ asset('js/pages/pers_access_stats/index.js') }}"></script>

{% endblock %}
